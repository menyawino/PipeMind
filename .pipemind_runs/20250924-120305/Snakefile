# Auto-generated by pipemind.snakemake.generator at 2025-09-24 12:01:52
rule all:
    input:
        '{config.outdir}/analysis/006_variant_filtering/S2.filtered.snp.vcf'

rule base_recalibrator:
    input:
        bam='rules.mark_duplicates.output.markdup_bam'
    output:
        recal_table='{config.outdir}/analysis/003_alignment/05_bqsr/{sample}.recal_data.table'
    threads: 4
    conda: 'icc_gatk'
    shell: "gatk BaseRecalibratorSpark -I {input.bam} -R {params.ref} -O {output.recal_table} --known-sites {params.known_sites} --spark-master local[{threads}] --conf spark.ui.enabled=false > {log} 2>&1"

rule filter_snps:
    input:
        snp_vcf='rules.split_vcfs.output.snp_vcf'
    output:
        filtered_snp_vcf='{config.outdir}/analysis/006_variant_filtering/{sample}.filtered.snp.vcf'
    conda: 'icc_gatk'
    shell: "gatk VariantFiltration -R {params.ref} -V {input.snp_vcf} -O {output.filtered_snp_vcf} --filter-expression \"QD < 2.0\" --filter-expression \"FS > 60.0\" --filter-expression \"MQ < 40.0\" --filter-expression \"MQRankSum < -12.5\" --filter-expression \"ReadPosRankSum < -8.0\" --filter-name \"QDFilter\" --filter-name \"FSFilter\" --filter-name \"MQFilter\" --filter-name \"MQRankSumFilter\" --filter-name \"ReadPosFilter\" --intervals {params.target} &> {log}"
